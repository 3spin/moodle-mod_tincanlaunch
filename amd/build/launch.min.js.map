{"version":3,"file":"launch.min.js","sources":["../src/launch.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handles display of the launch attempt table (registrations).\n *\n * @package\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    David Pesce  (david.pesce [at] exputo [dt] com)\n * @module    mod_tincanlaunch/launch\n */\n\ndefine(['jquery', 'core/str'], function($, Str) {\n\n    var id = '';\n    var n = '';\n\n    var SELECTORS = {\n        ATTEMPT_PROGRESS: '#tincanlaunch_attemptprogress',\n        ATTEMPT_TABLE: '#tincanlaunch_attempttable',\n        COMPLETION_CHECK: '#tincanlaunch_completioncheck',\n        EXIT: '#tincanlaunch_exit',\n        LAUNCH_FORM: '#launchform',\n        MAINCONTENT: '#maincontent',\n        NEW_ATTEMPT: '#tincanlaunch_newattempt',\n        NEW_ATTEMPT_LINK: '[id^=tincanlaunch_newattemptlink-]',\n        REATTEMPT: '[id^=tincanrelaunch_attempt-]',\n        REGISTRATION: '#launchform_registration',\n        STATUSDIV: '#tincanlaunch_status',\n        STATUSPARA: '#tincanlaunch_status_para'\n    };\n\n    var Launch = {\n        init: function() {\n            var self = this;\n\n            // Retrieve id and n URL parameters\n            var urlparams = new URLSearchParams(window.location.search);\n            id = urlparams.get('id');\n            n = urlparams.get('n');\n\n            // Iterate over table registrations and add necessary values.\n            $(SELECTORS.REATTEMPT).each(function() {\n                var registrationid = $(this).attr('id').substring(23);\n\n                // Listen for keyUp event.\n                $(this).keyup(function(e) {\n                    self.keyTest(e.keyCode, registrationid);\n                });\n\n                // Listen for click event.\n                $(this).click(function() {\n                    self.launchExperience(registrationid);\n                });\n\n                // Add tabindex and cursor.\n                $(this).attr('tabindex', '0');\n                $(this).attr('class', 'btn btn-primary');\n                $(this).attr('style', 'text-align: right');\n            });\n\n            // Add details to new attempt link.\n            var newregistrationid = $(SELECTORS.NEW_ATTEMPT_LINK).attr('id').substring(28);\n            $(SELECTORS.NEW_ATTEMPT_LINK).attr('tabindex', '0');\n            $(SELECTORS.NEW_ATTEMPT_LINK).attr('style', 'text-align: right');\n\n            $(SELECTORS.NEW_ATTEMPT_LINK).click(function() {\n                self.launchExperience(newregistrationid);\n            });\n\n            $(SELECTORS.NEW_ATTEMPT_LINK).keyup(function(e) {\n                self.keyTest(e.keyCode, newregistrationid);\n            });\n\n            // Add status para.\n            var statuspara = $(\"<p></p>\").attr(\"id\", \"tincanlaunch_status_para\");\n\n            // Add completion span.\n            var completionspan = $(\"<span>\").attr(\"id\", \"tincanlaunch_completioncheck\");\n            $(SELECTORS.STATUSDIV).append(statuspara, completionspan);\n\n            // Periodically check completion\n            setInterval(function() {\n                $(SELECTORS.COMPLETION_CHECK).load('completion_check.php?id=' + id + '&n=' + n);\n            }, 30000); // TODO: make this interval a configuration setting.\n        },\n        keyTest: function(keycode, registrationid) {\n            var self = this;\n            if (keycode === 13 || keycode === 32) {\n                self.launchExperience(registrationid);\n            }\n        },\n        launchExperience: function(registrationid) {\n            var stringsToRetrieve = [\n                {\n                    key: 'tincanlaunch_progress',\n                    component: 'tincanlaunch'\n                },\n                {\n                    key: 'returntocourse',\n                    component: 'tincanlaunch'\n                }\n            ];\n            $(SELECTORS.REGISTRATION).val(registrationid);\n            $(SELECTORS.LAUNCH_FORM).submit();\n            $(SELECTORS.NEW_ATTEMPT).remove();\n            $(SELECTORS.ATTEMPT_TABLE).remove();\n\n            Str.get_strings(stringsToRetrieve)\n                .done(function(s) {\n                    // Attempt in progress.\n                    $(SELECTORS.STATUSPARA).text(s[0]);\n\n                    // Return to course.\n                    var exitpara = $(\"<p></p>\").attr(\"id\", SELECTORS.EXIT);\n                    exitpara.html(\"<a href='complete.php?id=\" + id + \"&n=\" + n + \"'>\" + s[1] + \"</a>\");\n                    $(SELECTORS.STATUSPARA).after(exitpara);\n            });\n        }\n\n    };\n\n    return Launch;\n});"],"names":["define","$","Str","id","n","SELECTORS","init","self","this","urlparams","URLSearchParams","window","location","search","get","each","registrationid","attr","substring","keyup","e","keyTest","keyCode","click","launchExperience","newregistrationid","statuspara","completionspan","append","setInterval","load","keycode","val","submit","remove","get_strings","key","component","done","s","text","exitpara","html","after"],"mappings":";;;;;;;;AAwBAA,OAAM,0BAAC,CAAC,SAAU,aAAa,SAASC,EAAGC,KAEvC,IAAIC,GAAK,GACLC,EAAI,GAEJC,wBAEe,6BAFfA,2BAGkB,gCAHlBA,eAIM,qBAJNA,sBAKa,cALbA,sBAOa,2BAPbA,2BAQkB,qCARlBA,oBASW,gCATXA,uBAUc,2BAVdA,oBAWW,uBAXXA,qBAYY,4BA6FhB,MA1Fa,CACTC,KAAM,WACF,IAAIC,KAAOC,KAGPC,UAAY,IAAIC,gBAAgBC,OAAOC,SAASC,QACpDV,GAAKM,UAAUK,IAAI,MACnBV,EAAIK,UAAUK,IAAI,KAGlBb,EAAEI,qBAAqBU,MAAK,WACxB,IAAIC,eAAiBf,EAAEO,MAAMS,KAAK,MAAMC,UAAU,IAGlDjB,EAAEO,MAAMW,OAAM,SAASC,GACnBb,KAAKc,QAAQD,EAAEE,QAASN,eAC5B,IAGAf,EAAEO,MAAMe,OAAM,WACVhB,KAAKiB,iBAAiBR,eAC1B,IAGAf,EAAEO,MAAMS,KAAK,WAAY,KACzBhB,EAAEO,MAAMS,KAAK,QAAS,mBACtBhB,EAAEO,MAAMS,KAAK,QAAS,oBAC1B,IAGA,IAAIQ,kBAAoBxB,EAAEI,4BAA4BY,KAAK,MAAMC,UAAU,IAC3EjB,EAAEI,4BAA4BY,KAAK,WAAY,KAC/ChB,EAAEI,4BAA4BY,KAAK,QAAS,qBAE5ChB,EAAEI,4BAA4BkB,OAAM,WAChChB,KAAKiB,iBAAiBC,kBAC1B,IAEAxB,EAAEI,4BAA4Bc,OAAM,SAASC,GACzCb,KAAKc,QAAQD,EAAEE,QAASG,kBAC5B,IAGA,IAAIC,WAAazB,EAAE,WAAWgB,KAAK,KAAM,4BAGrCU,eAAiB1B,EAAE,UAAUgB,KAAK,KAAM,gCAC5ChB,EAAEI,qBAAqBuB,OAAOF,WAAYC,gBAG1CE,aAAY,WACR5B,EAAEI,4BAA4ByB,KAAK,2BAA6B3B,GAAK,MAAQC,EAChF,GAAE,IACN,EACDiB,QAAS,SAASU,QAASf,gBAEP,KAAZe,SAA8B,KAAZA,SADXvB,KAEFgB,iBAAiBR,eAE7B,EACDQ,iBAAkB,SAASR,gBAWvBf,EAAEI,wBAAwB2B,IAAIhB,gBAC9Bf,EAAEI,uBAAuB4B,SACzBhC,EAAEI,uBAAuB6B,SACzBjC,EAAEI,yBAAyB6B,SAE3BhC,IAAIiC,YAfoB,CACpB,CACIC,IAAK,wBACLC,UAAW,gBAEf,CACID,IAAK,iBACLC,UAAW,kBASdC,MAAK,SAASC,GAEXtC,EAAEI,sBAAsBmC,KAAKD,EAAE,IAG/B,IAAIE,SAAWxC,EAAE,WAAWgB,KAAK,KAAMZ,gBACvCoC,SAASC,KAAK,4BAA8BvC,GAAK,MAAQC,EAAI,KAAOmC,EAAE,GAAK,QAC3EtC,EAAEI,sBAAsBsC,MAAMF,SACtC,GACJ,EAKR"}