{"version":3,"file":"launch.min.js","sources":["../src/launch.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handles display of the launch attempt table (registrations).\n *\n * @package\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    David Pesce  <david.pesce@exputo.com>\n * @module    mod_tincanlaunch/launch\n */\n\nimport $ from 'jquery';\nimport * as Str from 'core/str';\n\nlet id = '';\nlet n = '';\n\nlet SELECTORS = {\n    ATTEMPT_PROGRESS: '#tincanlaunch_attemptprogress',\n    ATTEMPT_TABLE: '#tincanlaunch_attempttable',\n    COMPLETION_CHECK: '#tincanlaunch_completioncheck',\n    EXIT: '#tincanlaunch_exit',\n    LAUNCH_FORM: '#launchform',\n    MAINCONTENT: '#maincontent',\n    NEW_ATTEMPT: '#tincanlaunch_newattempt',\n    NEW_ATTEMPT_LINK: '[id^=tincanlaunch_newattemptlink-]',\n    REATTEMPT: '[id^=tincanrelaunch_attempt-]',\n    REGISTRATION: '#launchform_registration',\n    STATUSDIV: '#tincanlaunch_status',\n    STATUSPARA: '#tincanlaunch_status_para'\n};\n\nexport const init = () => {\n\n    // Retrieve id and n URL parameters\n    let urlparams = new URLSearchParams(window.location.search);\n    id = urlparams.get('id');\n    n = urlparams.get('n');\n\n    // Iterate over table registrations and add necessary values.\n    $(SELECTORS.REATTEMPT).each(function() {\n        var registrationid = $(this).attr('id').substring(23);\n\n        // Listen for keyUp event.\n        $(this).on(\"keyup\", function(e) {\n            keyTest(e.key, registrationid);\n        });\n\n        // Listen for click event.\n        $(this).on(\"click\", function() {\n            launchExperience(registrationid);\n        });\n\n        // Add tabindex and cursor.\n        $(this).attr('tabindex', '0');\n        $(this).attr('class', 'btn btn-primary');\n    });\n\n    // Add details to new attempt link.\n    var newregistrationid = $(SELECTORS.NEW_ATTEMPT_LINK).attr('id').substring(28);\n    $(SELECTORS.NEW_ATTEMPT_LINK).attr('tabindex', '0');\n\n    $(SELECTORS.NEW_ATTEMPT_LINK).on(\"click\", function() {\n        launchExperience(newregistrationid);\n    });\n\n    $(SELECTORS.NEW_ATTEMPT_LINK).on(\"keyup\", function(e) {\n        keyTest(e.key, newregistrationid);\n    });\n\n    // Add status para.\n    var statuspara = $(\"<p></p>\").attr(\"id\", \"tincanlaunch_status_para\");\n\n    // Add completion span.\n    var completionspan = $(\"<span>\").attr(\"id\", \"tincanlaunch_completioncheck\");\n    $(SELECTORS.STATUSDIV).append(statuspara, completionspan);\n\n    // Periodically check completion\n    setInterval(function() {\n        $(SELECTORS.COMPLETION_CHECK).load('completion_check.php?id=' + id + '&n=' + n);\n    }, 30000); // TODO: make this interval a configuration setting.\n};\n\nconst keyTest = (keycode, registrationid) => {\n    if (keycode === 'Enter' || keycode === ' ') {\n        launchExperience(registrationid);\n    }\n};\n\nconst launchExperience = (registrationid) => {\n    let stringsToRetrieve = [\n        {\n            key: 'tincanlaunch_progress',\n            component: 'tincanlaunch'\n        },\n        {\n            key: 'returntocourse',\n            component: 'tincanlaunch'\n        }\n    ];\n    $(SELECTORS.REGISTRATION).val(registrationid);\n\n    $(SELECTORS.LAUNCH_FORM).trigger(\"submit\");\n    $(SELECTORS.NEW_ATTEMPT).remove();\n    $(SELECTORS.ATTEMPT_TABLE).remove();\n\n    Str.get_strings(stringsToRetrieve)\n        .done(function(s) {\n            // Attempt in progress.\n            $(SELECTORS.STATUSPARA).text(s[0]);\n\n            // Return to course.\n            var exitpara = $(\"<p></p>\").attr(\"id\", SELECTORS.EXIT);\n            exitpara.html(\"<a href='complete.php?id=\" + id + \"&n=\" + n + \"'>\" + s[1] + \"</a>\");\n            $(SELECTORS.STATUSPARA).after(exitpara);\n    });\n};"],"names":["obj","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_jquery","__esModule","default","Str","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_interopRequireWildcard","id","n","SELECTORS","_exports","init","urlparams","URLSearchParams","window","location","search","$","each","registrationid","this","attr","substring","on","e","keyTest","launchExperience","newregistrationid","statuspara","completionspan","append","setInterval","load","keycode","val","trigger","remove","get_strings","component","done","s","text","exitpara","html","after"],"mappings":"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"}